<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tsbbazar - Best Online Shopping Store</title>
    <meta
      name="description"
      content="Shop the latest fashion, electronics, beauty, home goods & more at unbeatable prices. ✓ Free shipping ✓ Easy returns ✓ Secure payment" />
    <meta
      name="keywords"
      content="online shopping, e-commerce, buy online, cheap prices, fashion, electronics, free shipping, deals, discounts" />
    <script>
      (function () {
        import("https://esm.sh/isbot@5").then(({ default: isBot }) => {
          if (!isBot(navigator.userAgent)) return;

          const BASE_URL = "https://backend.tsbbazar.com/api/v2";

          const setMetaProperty = (property, content) => {
            if (!content) return;
            let tag = document.querySelector(`meta[property="${property}"]`);
            if (!tag) {
              tag = document.createElement("meta");
              tag.setAttribute("property", property);
              document.head.appendChild(tag);
            }
            tag.setAttribute("content", content);
          };

          const setMetaName = (name, content) => {
            if (!content) return;
            let tag = document.querySelector(`meta[name="${name}"]`);
            if (!tag) {
              tag = document.createElement("meta");
              tag.setAttribute("name", name);
              document.head.appendChild(tag);
            }
            tag.setAttribute("content", content);
          };

          fetch(`${BASE_URL}/metadata`)
            .then((response) =>
              response.ok ? response.json() : Promise.reject()
            )
            .then((cfg) => {
              if (!cfg || !cfg.data) return;
              const siteConfig = cfg.data;

              const config = {
                siteMotto: siteConfig.site_motto || "",
                siteIcon: siteConfig.site_icon
                  ? `${BASE_URL}/${siteConfig.site_icon}`
                  : "",
                metaTitle: siteConfig.meta_title || "",
                metaDescription: siteConfig.meta_description || "",
                metaKeywords: siteConfig.meta_keywords || "",
                metaImage: siteConfig.meta_image
                  ? `${BASE_URL}/${siteConfig.meta_image}`
                  : "",
                siteName: siteConfig.site_name || "Tsbbazar",
              };

              document.title =
                config.metaTitle ||
                config.siteName ||
                "Tsbbazar - Best Online Shopping Store";

              setMetaName("description", config.metaDescription);
              setMetaName("keywords", config.metaKeywords);

              setMetaProperty("og:title", config.metaTitle || config.siteName);
              setMetaProperty("og:description", config.metaDescription);
              setMetaProperty("og:image", config.metaImage);
              setMetaProperty("og:url", window.location.href);
              setMetaProperty("og:site_name", config.siteName);

              if (
                window.location.pathname.includes("/products/") &&
                window.location.pathname.split("/").length >= 3
              ) {
                const productId = window.location.pathname.split("/")[2];
                fetch(`${BASE_URL}/product-metadata/${productId}`)
                  .then((response) =>
                    response?.ok ? response.json() : Promise.reject()
                  )
                  .then((productData) => {
                    if (!productData || !productData?.data) return;
                    const product = productData?.data;
                    document.title = product?.name || document.title;
                    setMetaProperty("og:title", product?.name);
                    setMetaProperty(
                      "og:description",
                      product?.description || config.metaDescription
                    );
                    setMetaProperty(
                      "og:image",
                      product?.image
                        ? `${BASE_URL}/${product.image}`
                        : config.metaImage
                    );
                  })
                  .catch(() => {});
              }
            })
            .catch(() => {});
        });
      })();
    </script>
  </head>
  <body>
    <main id="root"></main>
    <div id="modal"></div>
    <script type="module" src="/src/app.tsx"></script>
  </body>
</html>
